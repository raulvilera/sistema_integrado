<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão de Equipamentos Tecnológicos</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== VARIÁVEIS DE CORES ===== */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #2980b9;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --white: #ffffff;
            --gray-light: #bdc3c7;
            --gray-medium: #95a5a6;
            --gray-dark: #7f8c8d;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        /* ===== ESTILOS GERAIS ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== CABEÇALHO ===== */
        header {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 20px 0;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background-color: #c0392b;
        }

        /* ===== NAVEGAÇÃO ===== */
        .nav-tabs {
            display: flex;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .nav-tab {
            padding: 15px 25px;
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
            text-align: center;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-tab.active {
            background-color: var(--accent-color);
        }

        /* ===== CONTEÚDO DAS ABAS ===== */
        .tab-content {
            display: none;
            background-color: var(--white);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== FORMULÁRIOS ===== */
        .form-title {
            margin-bottom: 20px;
            color: var(--primary-color);
            font-size: 22px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--secondary-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 15px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: var(--gray-medium);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--gray-dark);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #219653;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* ===== TABELAS ===== */
        .table-responsive {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }

        .data-table th {
            background-color: var(--secondary-color);
            color: var(--white);
            font-weight: 500;
            text-transform: uppercase;
            font-size: 14px;
        }

        .data-table tr:hover {
            background-color: rgba(52, 152, 219, 0.05);
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-primary {
            background-color: var(--accent-color);
            color: white;
        }

        .badge-success {
            background-color: var(--success-color);
            color: white;
        }

        .badge-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .badge-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .badge-info {
            background-color: var(--info-color);
            color: white;
        }

        /* ===== CARDS DE DASHBOARD ===== */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 16px;
            color: var(--secondary-color);
            font-weight: 500;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .card-icon.primary {
            background-color: var(--accent-color);
        }

        .card-icon.success {
            background-color: var(--success-color);
        }

        .card-icon.warning {
            background-color: var(--warning-color);
        }

        .card-icon.danger {
            background-color: var(--danger-color);
        }

        .card-body {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* ===== GRÁFICOS ===== */
        .chart-container {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 30px;
            height: 400px;
        }

        /* ===== MODAIS ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray-medium);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* ===== RESPONSIVIDADE ===== */
        @media (max-width: 768px) {
            .nav-tabs {
                flex-wrap: wrap;
            }

            .nav-tab {
                flex: 1 0 33%;
                padding: 12px 5px;
                font-size: 14px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        /* ===== ANIMAÇÕES ===== */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* ===== ESTILOS ESPECÍFICOS PARA RELATÓRIOS ===== */
        .report-section {
            margin-bottom: 30px;
        }

        .report-title {
            font-size: 18px;
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--accent-color);
        }

        .equipment-category {
            margin-bottom: 20px;
        }

        .category-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        /* ===== ESTILOS PARA O FORMULÁRIO DE AGENDAMENTO ===== */
        .schedule-form .form-group {
            margin-bottom: 20px;
        }

        .schedule-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        /* ===== ESTILOS PARA O HISTÓRICO ===== */
        .history-item {
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
            transition: var(--transition);
        }

        .history-item:hover {
            background-color: #f8f9fa;
        }

        .history-date {
            font-weight: bold;
            color: var(--secondary-color);
        }

        .history-action {
            margin-top: 5px;
        }

        /* ===== ESTILOS PARA O FILTRO DE EQUIPAMENTOS ===== */
        .filter-container {
            background-color: var(--white);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        /* ===== ESTILOS PARA O STATUS DOS EQUIPAMENTOS ===== */
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-available {
            background-color: var(--success-color);
        }

        .status-inuse {
            background-color: var(--accent-color);
        }

        .status-maintenance {
            background-color: var(--warning-color);
        }

        .status-damaged {
            background-color: var(--danger-color);
        }

        .status-unused {
            background-color: var(--gray-medium);
        }

        /* ===== ESTILOS PARA A PÁGINA DE REGISTRO ===== */
        .register-form {
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
        }

        .equipment-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-end;
        }

        .equipment-row > div {
            flex: 1;
        }

        .add-equipment-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-equipment-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .time-input-group {
            display: flex;
            gap: 10px;
        }

        .time-input-group .form-group {
            flex: 1;
        }

        .auto-fill-label {
            font-size: 12px;
            color: var(--gray-dark);
            margin-top: 5px;
        }

        .registration-codes {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .codes-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .code-item {
            background-color: var(--accent-color);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        /* ===== ESTILOS PARA O TERMO DE RESPONSABILIDADE ===== */
        .termo-container {
            padding: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-top: 20px;
            display: none;
        }

        .termo-title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .termo-content {
            line-height: 1.8;
        }

        .termo-signature {
            margin-top: 40px;
            text-align: center;
        }

        .termo-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .termo-table th, .termo-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .termo-table th {
            background-color: #f2f2f2;
        }

        .termo-info {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="container" style="max-width: 500px; margin-top: 100px;">
        <div class="card" style="text-align: center;">
            <h2 style="margin-bottom: 30px; color: var(--primary-color);">Sistema de Gestão de Equipamentos</h2>
            <div class="form-group">
                <label for="loginEmail">E-mail Institucional</label>
                <input type="email" id="loginEmail" class="form-control" placeholder="seu.email@escola.gov.br" value="professor@escola.gov.br">
            </div>
            <div class="form-group">
                <label for="loginPassword">Senha</label>
                <input type="password" id="loginPassword" class="form-control" value="senha123">
            </div>
            <div class="btn-group" style="justify-content: center;">
                <button id="loginBtn" class="btn btn-primary" onclick="login()">Entrar</button>
            </div>
        </div>
    </div>

    <!-- Sistema Principal (inicialmente oculto) -->
    <div id="mainSystem" style="display: none;">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-laptop"></i> Gestão de Equipamentos
                </div>
                <div class="user-info">
                    <span id="currentUser">Administrador</span>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="nav-tabs">
                <div class="nav-tab active" onclick="openTab('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </div>
                <div class="nav-tab" onclick="openTab('register')">
                    <i class="fas fa-plus-circle"></i> Cadastro
                </div>
                <div class="nav-tab" onclick="openTab('reservations')">
                    <i class="fas fa-calendar-check"></i> Reservas
                </div>
                <div class="nav-tab" onclick="openTab('reports')">
                    <i class="fas fa-file-alt"></i> Relatórios
                </div>
                <div class="nav-tab" onclick="openTab('maintenance')">
                    <i class="fas fa-tools"></i> Manutenção
                </div>
                <div class="nav-tab" onclick="openTab('registration')">
                    <i class="fas fa-clipboard-list"></i> Registro
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboard" class="tab-content active">
                <h2 class="form-title">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </h2>

                <div class="filter-container">
                    <div class="filter-group">
                        <label for="dashboardEquipmentFilter">Filtrar por Equipamento</label>
                        <select id="dashboardEquipmentFilter" class="form-control" onchange="updateDashboard()">
                            <option value="all">Todos os Equipamentos</option>
                            <option value="Notebook do aluno">Notebook do aluno</option>
                            <option value="Chromebooks">Chromebooks</option>
                            <option value="Smartphone">Smartphone</option>
                            <option value="Tablets">Tablets</option>
                            <option value="Notebook Ultra">Notebook Ultra</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="dashboardLocationFilter">Filtrar por Local</label>
                        <select id="dashboardLocationFilter" class="form-control" onchange="updateDashboard()">
                            <option value="all">Todos os Locais</option>
                            <option value="Sala dos professores">Sala dos professores</option>
                            <option value="Sala de informática">Sala de informática</option>
                            <option value="Depósito 1ª andar">Depósito 1ª andar</option>
                            <option value="Coordenação">Coordenação</option>
                            <option value="Direção">Direção</option>
                        </select>
                    </div>
                </div>

                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Em Uso</div>
                            <div class="card-icon primary">
                                <i class="fas fa-laptop-house"></i>
                            </div>
                        </div>
                        <div class="card-body" id="inUseCount">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Disponíveis</div>
                            <div class="card-icon success">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <div class="card-body" id="availableCount">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Em Manutenção</div>
                            <div class="card-icon warning">
                                <i class="fas fa-tools"></i>
                            </div>
                        </div>
                        <div class="card-body" id="maintenanceCount">0</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Danificados</div>
                            <div class="card-icon danger">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div class="card-body" id="damagedCount">0</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="equipmentChart"></canvas>
                </div>

                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Equipamento</th>
                                <th>Número de Série</th>
                                <th>Localização</th>
                                <th>Status</th>
                                <th>Última Atualização</th>
                            </tr>
                        </thead>
                        <tbody id="equipmentTableBody">
                            <!-- Dados serão preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Cadastro de Equipamentos -->
            <div id="register" class="tab-content">
                <h2 class="form-title">
                    <i class="fas fa-plus-circle"></i> Cadastrar Novo Equipamento
                </h2>
                
                <div class="register-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="equipmentType">Tipo de Equipamento</label>
                            <select id="equipmentType" class="form-control">
                                <option value="">Selecione...</option>
                                <option value="Notebook do aluno">Notebook do aluno</option>
                                <option value="Chromebooks">Chromebooks</option>
                                <option value="Smartphone">Smartphone</option>
                                <option value="Tablets">Tablets</option>
                                <option value="Notebook Ultra">Notebook Ultra</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="equipmentBrand">Marca</label>
                            <input type="text" id="equipmentBrand" class="form-control" placeholder="Ex: Dell, Samsung, etc.">
                        </div>
                        <div class="form-group">
                            <label for="equipmentModel">Modelo</label>
                            <input type="text" id="equipmentModel" class="form-control" placeholder="Ex: Inspiron 15, Galaxy Tab S6, etc.">
                        </div>
                        <div class="form-group">
                            <label for="serialNumber">Número de Série</label>
                            <input type="text" id="serialNumber" class="form-control" placeholder="Número único de identificação">
                        </div>
                        <div class="form-group">
                            <label for="purchaseDate">Data de Aquisição</label>
                            <input type="date" id="purchaseDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="warrantyExpiration">Término da Garantia</label>
                            <input type="date" id="warrantyExpiration" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="currentLocation">Localização Atual</label>
                            <select id="currentLocation" class="form-control">
                                <option value="">Selecione...</option>
                                <option value="Sala dos professores">Sala dos professores</option>
                                <option value="Sala de informática">Sala de informática</option>
                                <option value="Depósito 1ª andar">Depósito 1ª andar</option>
                                <option value="Coordenação">Coordenação</option>
                                <option value="Direção">Direção</option>
                                <option value="Outro">Outro local</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="equipmentStatus">Status</label>
                            <select id="equipmentStatus" class="form-control">
                                <option value="Disponível">Disponível</option>
                                <option value="Em uso">Em uso</option>
                                <option value="Manutenção">Manutenção</option>
                                <option value="Danificado">Danificado</option>
                                <option value="Inativo">Inativo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="additionalInfo">Informações Adicionais</label>
                            <textarea id="additionalInfo" class="form-control" rows="3" placeholder="Detalhes, observações, etc."></textarea>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="registerEquipment()">
                            <i class="fas fa-save"></i> Cadastrar Equipamento
                        </button>
                        <button class="btn btn-secondary" onclick="clearRegisterForm()">
                            <i class="fas fa-broom"></i> Limpar Formulário
                        </button>
                    </div>
                </div>
                
                <div class="registration-codes">
                    <h3 class="report-title">Códigos de Registro Gerados</h3>
                    <div class="codes-list" id="codesList">
                        <!-- Códigos serão adicionados dinamicamente -->
                    </div>
                </div>
            </div>

            <!-- Reservas -->
            <div id="reservations" class="tab-content">
                <h2 class="form-title">
                    <i class="fas fa-calendar-check"></i> Gerenciamento de Reservas
                </h2>
                
                <div class="filter-container">
                    <div class="filter-group">
                        <label for="reservationStatusFilter">Filtrar por Status</label>
                        <select id="reservationStatusFilter" class="form-control" onchange="loadReservations()">
                            <option value="all">Todas as Reservas</option>
                            <option value="pending">Pendentes</option>
                            <option value="approved">Aprovadas</option>
                            <option value="rejected">Rejeitadas</option>
                            <option value="completed">Concluídas</option>
                            <option value="canceled">Canceladas</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="reservationDateFilter">Filtrar por Data</label>
                        <input type="date" id="reservationDateFilter" class="form-control" onchange="loadReservations()">
                    </div>
                    <div class="filter-group">
                        <label for="reservationUserFilter">Filtrar por Usuário</label>
                        <input type="text" id="reservationUserFilter" class="form-control" placeholder="Nome do usuário" onchange="loadReservations()">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="openNewReservationModal()">
                        <i class="fas fa-plus"></i> Nova Reserva
                    </button>
                    <button class="btn btn-secondary" onclick="printReservations()">
                        <i class="fas fa-print"></i> Imprimir Relatório
                    </button>
                </div>
                
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Equipamento</th>
                                <th>Usuário</th>
                                <th>Data</th>
                                <th>Horário</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="reservationsTableBody">
                            <!-- Dados serão preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Relatórios -->
            <div id="reports" class="tab-content">
                <h2 class="form-title">
                    <i class="fas fa-file-alt"></i> Relatórios e Estatísticas
                </h2>
                
                <div class="filter-container">
                    <div class="filter-group">
                        <label for="reportType">Tipo de Relatório</label>
                        <select id="reportType" class="form-control" onchange="updateReport()">
                            <option value="equipmentStatus">Status dos Equipamentos</option>
                            <option value="reservationsByMonth">Reservas por Mês</option>
                            <option value="maintenanceHistory">Histórico de Manutenções</option>
                            <option value="equipmentByLocation">Equipamentos por Local</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="reportDateRange">Período</label>
                        <select id="reportDateRange" class="form-control" onchange="updateReport()">
                            <option value="last30">Últimos 30 dias</option>
                            <option value="last90">Últimos 90 dias</option>
                            <option value="currentMonth">Mês Atual</option>
                            <option value="lastMonth">Mês Anterior</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    <div class="filter-group" id="customDateRangeGroup" style="display: none;">
                        <label for="reportCustomStart">Data Inicial</label>
                        <input type="date" id="reportCustomStart" class="form-control" onchange="updateReport()">
                    </div>
                    <div class="filter-group" id="customDateRangeGroupEnd" style="display: none;">
                        <label for="reportCustomEnd">Data Final</label>
                        <input type="date" id="reportCustomEnd" class="form-control" onchange="updateReport()">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="generatePDFReport()">
                        <i class="fas fa-file-pdf"></i> Exportar para PDF
                    </button>
                    <button class="btn btn-success" onclick="exportToExcel()">
                        <i class="fas fa-file-excel"></i> Exportar para Excel
                    </button>
                </div>
                
                <div class="chart-container">
                    <canvas id="reportChart"></canvas>
                </div>
                
                <div class="table-responsive">
                    <table class="data-table" id="reportTable">
                        <thead>
                            <tr id="reportTableHeader">
                                <!-- Cabeçalho será preenchido dinamicamente -->
                            </tr>
                        </thead>
                        <tbody id="reportTableBody">
                            <!-- Dados serão preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Manutenção -->
            <div id="maintenance" class="tab-content">
                <h2 class="form-title">
                    <i class="fas fa-tools"></i> Registro de Manutenções
                </h2>
                
                <div class="filter-container">
                    <div class="filter-group">
                        <label for="maintenanceStatusFilter">Filtrar por Status</label>
                        <select id="maintenanceStatusFilter" class="form-control" onchange="loadMaintenanceRecords()">
                            <option value="all">Todos os Registros</option>
                            <option value="pending">Pendentes</option>
                            <option value="in_progress">Em Andamento</option>
                            <option value="completed">Concluídos</option>
                            <option value="canceled">Cancelados</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="maintenanceEquipmentFilter">Filtrar por Equipamento</label>
                        <select id="maintenanceEquipmentFilter" class="form-control" onchange="loadMaintenanceRecords()">
                            <option value="all">Todos os Equipamentos</option>
                            <!-- Opções serão preenchidas dinamicamente -->
                        </select>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="openNewMaintenanceModal()">
                        <i class="fas fa-plus"></i> Nova Manutenção
                    </button>
                </div>
                
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Equipamento</th>
                                <th>Número de Série</th>
                                <th>Problema</th>
                                <th>Data Registro</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="maintenanceTableBody">
                            <!-- Dados serão preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Registro -->
            <div id="registration" class="tab-content">
                <h2 class="form-title">
                    <i class="fas fa-clipboard-list"></i> Registro de Atividades
                </h2>
                
                <div class="filter-container">
                    <div class="filter-group">
                        <label for="activityTypeFilter">Filtrar por Tipo</label>
                        <select id="activityTypeFilter" class="form-control" onchange="loadActivities()">
                            <option value="all">Todas as Atividades</option>
                            <option value="equipment">Equipamentos</option>
                            <option value="reservation">Reservas</option>
                            <option value="maintenance">Manutenções</option>
                            <option value="user">Usuários</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="activityUserFilter">Filtrar por Usuário</label>
                        <input type="text" id="activityUserFilter" class="form-control" placeholder="Nome do usuário" onchange="loadActivities()">
                    </div>
                    <div class="filter-group">
                        <label for="activityDateFilter">Filtrar por Data</label>
                        <input type="date" id="activityDateFilter" class="form-control" onchange="loadActivities()">
                    </div>
                </div>
                
                <div class="history-list" id="activityList">
                    <!-- Atividades serão carregadas dinamicamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nova Reserva -->
    <div id="newReservationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-calendar-plus"></i> Nova Reserva de Equipamento
                </h3>
                <button class="modal-close" onclick="closeModal('newReservationModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="reservationEquipment">Equipamento</label>
                        <select id="reservationEquipment" class="form-control">
                            <!-- Opções serão preenchidas dinamicamente -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reservationUser">Usuário</label>
                        <input type="text" id="reservationUser" class="form-control" placeholder="Nome do usuário">
                    </div>
                    <div class="form-group">
                        <label for="reservationDate">Data</label>
                        <input type="date" id="reservationDate" class="form-control">
                    </div>
                    <div class="time-input-group">
                        <div class="form-group">
                            <label for="reservationStartTime">Hora Início</label>
                            <input type="time" id="reservationStartTime" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="reservationEndTime">Hora Fim</label>
                            <input type="time" id="reservationEndTime" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reservationPurpose">Finalidade</label>
                        <textarea id="reservationPurpose" class="form-control" rows="3" placeholder="Descreva a finalidade da reserva"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('newReservationModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="submitReservation()">Salvar Reserva</button>
            </div>
        </div>
    </div>

    <!-- Modal para Nova Manutenção -->
    <div id="newMaintenanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-tools"></i> Registrar Nova Manutenção
                </h3>
                <button class="modal-close" onclick="closeModal('newMaintenanceModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="maintenanceEquipment">Equipamento</label>
                        <select id="maintenanceEquipment" class="form-control" onchange="loadEquipmentDetails()">
                            <!-- Opções serão preenchidas dinamicamente -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="maintenanceSerialNumber">Número de Série</label>
                        <input type="text" id="maintenanceSerialNumber" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label for="maintenanceProblem">Problema Relatado</label>
                        <textarea id="maintenanceProblem" class="form-control" rows="3" placeholder="Descreva o problema encontrado"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="maintenanceDiagnosis">Diagnóstico Técnico</label>
                        <textarea id="maintenanceDiagnosis" class="form-control" rows="3" placeholder="Descreva o diagnóstico técnico"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="maintenanceStatus">Status</label>
                        <select id="maintenanceStatus" class="form-control">
                            <option value="pending">Pendente</option>
                            <option value="in_progress">Em Andamento</option>
                            <option value="completed">Concluído</option>
                            <option value="canceled">Cancelado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="maintenanceTechnician">Técnico Responsável</label>
                        <input type="text" id="maintenanceTechnician" class="form-control" placeholder="Nome do técnico">
                    </div>
                    <div class="form-group">
                        <label for="maintenanceCost">Custo Estimado (R$)</label>
                        <input type="number" id="maintenanceCost" class="form-control" placeholder="0.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="maintenanceExpectedDate">Previsão de Conclusão</label>
                        <input type="date" id="maintenanceExpectedDate" class="form-control">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('newMaintenanceModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="submitMaintenance()">Salvar Manutenção</button>
            </div>
        </div>
    </div>

    <!-- Modal para Termo de Responsabilidade -->
    <div id="responsibilityTermModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-file-signature"></i> Termo de Responsabilidade
                </h3>
                <button class="modal-close" onclick="closeModal('responsibilityTermModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="termo-container" id="termoContent">
                    <h3 class="termo-title">TERMO DE RESPONSABILIDADE</h3>
                    <div class="termo-content">
                        <p>Eu, <strong id="termoUserName">_________________________________________</strong>, portador(a) do CPF <strong id="termoUserCpf">________________________</strong>, declaro para os devidos fins que recebi da instituição <strong id="termoInstitution">Escola Estadual de Ensino Médio</strong> os equipamentos relacionados abaixo, comprometendo-me a utilizá-los exclusivamente para fins educacionais e a zelar por sua integridade física e funcional.</p>
                        
                        <p>Declaro ainda estar ciente de que sou responsável pela guarda e conservação dos equipamentos, bem como por eventuais danos que venham a ocorrer por uso indevido ou negligência, ficando sujeito às penalidades previstas no regulamento interno da instituição.</p>
                        
                        <table class="termo-table">
                            <thead>
                                <tr>
                                    <th>Equipamento</th>
                                    <th>Número de Série</th>
                                    <th>Acessórios</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="termoEquipmentTable">
                                <!-- Itens serão adicionados dinamicamente -->
                            </tbody>
                        </table>
                        
                        <p>Comprometo-me a devolver os equipamentos no prazo estipulado ou imediatamente quando solicitado pela instituição, sob pena de responder civil e criminalmente por sua retenção indevida.</p>
                        
                        <div class="termo-signature">
                            <p>_________________________________________</p>
                            <p>Assinatura do Responsável</p>
                        </div>
                        
                        <div class="termo-info">
                            <div>
                                <p>Data: <strong id="termoDate">__/__/____</strong></p>
                            </div>
                            <div>
                                <p>Cidade: <strong id="termoCity">________________________</strong></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('responsibilityTermModal')">Fechar</button>
                <button class="btn btn-primary" onclick="printTermo()">
                    <i class="fas fa-print"></i> Imprimir Termo
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            databaseURL: "https://SEU_PROJETO.firebaseio.com",
            projectId: "SEU_PROJETO",
            storageBucket: "SEU_PROJETO.appspot.com",
            messagingSenderId: "SEU_SENDER_ID",
            appId: "SEU_APP_ID"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // Variáveis globais
        let currentUser = null;
        let equipmentChart = null;
        let reportChart = null;

        // Inicializar o sistema quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se o usuário já está logado
            auth.onAuthStateChanged(user => {
                if (user) {
                    // Usuário logado
                    currentUser = user;
                    showMainSystem();
                    loadInitialData();
                } else {
                    // Nenhum usuário logado
                    showLoginScreen();
                }
            });
        });

        // Função para fazer login
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    currentUser = userCredential.user;
                    showMainSystem();
                    loadInitialData();
                })
                .catch(error => {
                    alert('Erro ao fazer login: ' + error.message);
                });
        }

        // Função para fazer logout
        function logout() {
            auth.signOut()
                .then(() => {
                    currentUser = null;
                    showLoginScreen();
                })
                .catch(error => {
                    alert('Erro ao fazer logout: ' + error.message);
                });
        }

        // Mostrar tela de login
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainSystem').style.display = 'none';
        }

        // Mostrar sistema principal
        function showMainSystem() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainSystem').style.display = 'block';
            document.getElementById('currentUser').textContent = currentUser.email;
        }

        // Abrir uma aba específica
        function openTab(tabId) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover classe active de todas as guias
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar a aba selecionada
            document.getElementById(tabId).classList.add('active');
            
            // Adicionar classe active à guia selecionada
            document.querySelectorAll('.nav-tab').forEach(tab => {
                if (tab.getAttribute('onclick').includes(tabId)) {
                    tab.classList.add('active');
                }
            });
            
            // Atualizar os dados da aba se necessário
            switch(tabId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'reservations':
                    loadReservations();
                    break;
                case 'reports':
                    updateReport();
                    break;
                case 'maintenance':
                    loadMaintenanceRecords();
                    break;
                case 'registration':
                    loadActivities();
                    break;
            }
        }

        // Carregar dados iniciais
        function loadInitialData() {
            updateDashboard();
            loadEquipmentForSelects();
            loadReservations();
            updateReport();
            loadMaintenanceRecords();
            loadActivities();
        }

        // Atualizar o dashboard
        function updateDashboard() {
            const equipmentFilter = document.getElementById('dashboardEquipmentFilter').value;
            const locationFilter = document.getElementById('dashboardLocationFilter').value;
            
            // Fazer consulta ao Firebase com os filtros aplicados
            let equipmentRef = database.ref('equipments');
            
            if (equipmentFilter !== 'all' || locationFilter !== 'all') {
                equipmentRef = equipmentRef.orderByChild('filterKey');
            }
            
            equipmentRef.once('value', snapshot => {
                const equipments = snapshot.val() || {};
                let inUseCount = 0;
                let availableCount = 0;
                let maintenanceCount = 0;
                let damagedCount = 0;
                
                const filteredEquipments = Object.values(equipments).filter(equipment => {
                    // Aplicar filtros
                    if (equipmentFilter !== 'all' && equipment.type !== equipmentFilter) return false;
                    if (locationFilter !== 'all' && equipment.location !== locationFilter) return false;
                    return true;
                });
                
                // Contar status
                filteredEquipments.forEach(equipment => {
                    switch(equipment.status) {
                        case 'Em uso':
                            inUseCount++;
                            break;
                        case 'Disponível':
                            availableCount++;
                            break;
                        case 'Manutenção':
                            maintenanceCount++;
                            break;
                        case 'Danificado':
                            damagedCount++;
                            break;
                    }
                });
                
                // Atualizar contadores
                document.getElementById('inUseCount').textContent = inUseCount;
                document.getElementById('availableCount').textContent = availableCount;
                document.getElementById('maintenanceCount').textContent = maintenanceCount;
                document.getElementById('damagedCount').textContent = damagedCount;
                
                // Atualizar tabela
                const tableBody = document.getElementById('equipmentTableBody');
                tableBody.innerHTML = '';
                
                filteredEquipments.forEach(equipment => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${equipment.type || 'N/A'}</td>
                        <td>${equipment.serialNumber || 'N/A'}</td>
                        <td>${equipment.location || 'N/A'}</td>
                        <td>
                            <span class="status-indicator ${getStatusClass(equipment.status)}"></span>
                            ${equipment.status || 'N/A'}
                        </td>
                        <td>${formatDate(equipment.lastUpdated) || 'N/A'}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Atualizar gráfico
                updateEquipmentChart(filteredEquipments);
            });
        }

        // Atualizar gráfico de equipamentos
        function updateEquipmentChart(equipments) {
            const ctx = document.getElementById('equipmentChart').getContext('2d');
            
            // Agrupar por tipo de equipamento
            const equipmentTypes = {};
            equipments.forEach(equipment => {
                if (!equipmentTypes[equipment.type]) {
                    equipmentTypes[equipment.type] = {
                        total: 0,
                        available: 0,
                        inUse: 0,
                        maintenance: 0,
                        damaged: 0
                    };
                }
                
                equipmentTypes[equipment.type].total++;
                
                switch(equipment.status) {
                    case 'Disponível':
                        equipmentTypes[equipment.type].available++;
                        break;
                    case 'Em uso':
                        equipmentTypes[equipment.type].inUse++;
                        break;
                    case 'Manutenção':
                        equipmentTypes[equipment.type].maintenance++;
                        break;
                    case 'Danificado':
                        equipmentTypes[equipment.type].damaged++;
                        break;
                }
            });
            
            const labels = Object.keys(equipmentTypes);
            const availableData = labels.map(type => equipmentTypes[type].available);
            const inUseData = labels.map(type => equipmentTypes[type].inUse);
            const maintenanceData = labels.map(type => equipmentTypes[type].maintenance);
            const damagedData = labels.map(type => equipmentTypes[type].damaged);
            
            if (equipmentChart) {
                equipmentChart.destroy();
            }
            
            equipmentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Disponíveis',
                            data: availableData,
                            backgroundColor: 'rgba(39, 174, 96, 0.7)',
                            borderColor: 'rgba(39, 174, 96, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Em Uso',
                            data: inUseData,
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Manutenção',
                            data: maintenanceData,
                            backgroundColor: 'rgba(243, 156, 18, 0.7)',
                            borderColor: 'rgba(243, 156, 18, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Danificados',
                            data: damagedData,
                            backgroundColor: 'rgba(231, 76, 60, 0.7)',
                            borderColor: 'rgba(231, 76, 60, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantidade de Equipamentos'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Tipo de Equipamento'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Distribuição de Equipamentos por Status',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Registrar novo equipamento
        function registerEquipment() {
            const equipmentData = {
                type: document.getElementById('equipmentType').value,
                brand: document.getElementById('equipmentBrand').value,
                model: document.getElementById('equipmentModel').value,
                serialNumber: document.getElementById('serialNumber').value,
                purchaseDate: document.getElementById('purchaseDate').value,
                warrantyExpiration: document.getElementById('warrantyExpiration').value,
                location: document.getElementById('currentLocation').value,
                status: document.getElementById('equipmentStatus').value,
                additionalInfo: document.getElementById('additionalInfo').value,
                registeredBy: currentUser.email,
                registrationDate: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };
            
            // Validar campos obrigatórios
            if (!equipmentData.type || !equipmentData.serialNumber || !equipmentData.location || !equipmentData.status) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            // Gerar um ID único para o equipamento
            const equipmentId = database.ref().child('equipments').push().key;
            
            // Salvar no Firebase
            database.ref('equipments/' + equipmentId).set(equipmentData)
                .then(() => {
                    alert('Equipamento cadastrado com sucesso!');
                    
                    // Gerar código de registro
                    const registrationCode = generateRegistrationCode(equipmentId, equipmentData.serialNumber);
                    addRegistrationCode(registrationCode);
                    
                    // Limpar formulário
                    clearRegisterForm();
                    
                    // Atualizar dashboard
                    updateDashboard();
                })
                .catch(error => {
                    alert('Erro ao cadastrar equipamento: ' + error.message);
                });
        }

        // Limpar formulário de cadastro
        function clearRegisterForm() {
            document.getElementById('equipmentType').value = '';
            document.getElementById('equipmentBrand').value = '';
            document.getElementById('equipmentModel').value = '';
            document.getElementById('serialNumber').value = '';
            document.getElementById('purchaseDate').value = '';
            document.getElementById('warrantyExpiration').value = '';
            document.getElementById('currentLocation').value = '';
            document.getElementById('equipmentStatus').value = 'Disponível';
            document.getElementById('additionalInfo').value = '';
        }

        // Gerar código de registro
        function generateRegistrationCode(equipmentId, serialNumber) {
            const timestamp = new Date().getTime().toString(36);
            const randomPart = Math.random().toString(36).substr(2, 5);
            return `EQ-${serialNumber.substr(0, 3)}-${timestamp}-${randomPart}`.toUpperCase();
        }

        // Adicionar código de registro à lista
        function addRegistrationCode(code) {
            const codesList = document.getElementById('codesList');
            const codeItem = document.createElement('div');
            codeItem.className = 'code-item';
            codeItem.textContent = code;
            codesList.appendChild(codeItem);
        }

        // Carregar equipamentos para selects
        function loadEquipmentForSelects() {
            database.ref('equipments').once('value', snapshot => {
                const equipments = snapshot.val() || {};
                const equipmentSelects = [
                    document.getElementById('reservationEquipment'),
                    document.getElementById('maintenanceEquipment'),
                    document.getElementById('maintenanceEquipmentFilter')
                ];
                
                // Limpar selects
                equipmentSelects.forEach(select => {
                    // Manter a primeira opção (se houver)
                    while (select.options.length > 1) {
                        select.remove(1);
                    }
                });
                
                // Adicionar equipamentos
                Object.values(equipments).forEach(equipment => {
                    equipmentSelects.forEach(select => {
                        if (select) {
                            const option = document.createElement('option');
                            option.value = equipment.serialNumber;
                            option.textContent = `${equipment.type} (${equipment.serialNumber})`;
                            select.appendChild(option);
                        }
                    });
                });
            });
        }

        // Carregar reservas
        function loadReservations() {
            const statusFilter = document.getElementById('reservationStatusFilter').value;
            const dateFilter = document.getElementById('reservationDateFilter').value;
            const userFilter = document.getElementById('reservationUserFilter').value.toLowerCase();
            
            database.ref('reservations').once('value', snapshot => {
                const reservations = snapshot.val() || {};
                const tableBody = document.getElementById('reservationsTableBody');
                tableBody.innerHTML = '';
                
                Object.values(reservations).forEach(reservation => {
                    // Aplicar filtros
                    if (statusFilter !== 'all' && reservation.status !== statusFilter) return;
                    if (dateFilter && reservation.date !== dateFilter) return;
                    if (userFilter && !reservation.user.toLowerCase().includes(userFilter)) return;
                    
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${reservation.id || 'N/A'}</td>
                        <td>${reservation.equipment || 'N/A'}</td>
                        <td>${reservation.user || 'N/A'}</td>
                        <td>${formatDate(reservation.date) || 'N/A'}</td>
                        <td>${reservation.startTime} - ${reservation.endTime}</td>
                        <td><span class="badge ${getStatusBadgeClass(reservation.status)}">${reservation.status || 'N/A'}</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="viewReservationDetails('${reservation.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${reservation.status === 'pending' ? `
                            <button class="btn btn-success btn-sm" onclick="approveReservation('${reservation.id}')">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="rejectReservation('${reservation.id}')">
                                <i class="fas fa-times"></i>
                            </button>
                            ` : ''}
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            });
        }

        // Abrir modal de nova reserva
        function openNewReservationModal() {
            // Preencher select de equipamentos (já feito em loadEquipmentForSelects)
            document.getElementById('reservationModal').style.display = 'flex';
        }

        // Fechar modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Submeter nova reserva
        function submitReservation() {
            const reservationData = {
                equipment: document.getElementById('reservationEquipment').value,
                user: document.getElementById('reservationUser').value,
                date: document.getElementById('reservationDate').value,
                startTime: document.getElementById('reservationStartTime').value,
                endTime: document.getElementById('reservationEndTime').value,
                purpose: document.getElementById('reservationPurpose').value,
                status: 'pending',
                createdBy: currentUser.email,
                createdAt: new Date().toISOString()
            };
            
            // Validar campos obrigatórios
            if (!reservationData.equipment || !reservationData.user || !reservationData.date || 
                !reservationData.startTime || !reservationData.endTime) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            // Gerar ID único para a reserva
            const reservationId = database.ref().child('reservations').push().key;
            reservationData.id = reservationId;
            
            // Salvar no Firebase
            database.ref('reservations/' + reservationId).set(reservationData)
                .then(() => {
                    alert('Reserva cadastrada com sucesso!');
                    closeModal('newReservationModal');
                    loadReservations();
                })
                .catch(error => {
                    alert('Erro ao cadastrar reserva: ' + error.message);
                });
        }

        // Aprovar reserva
        function approveReservation(reservationId) {
            database.ref('reservations/' + reservationId).update({
                status: 'approved',
                approvedBy: currentUser.email,
                approvedAt: new Date().toISOString()
            })
            .then(() => {
                loadReservations();
            })
            .catch(error => {
                alert('Erro ao aprovar reserva: ' + error.message);
            });
        }

        // Rejeitar reserva
        function rejectReservation(reservationId) {
            database.ref('reservations/' + reservationId).update({
                status: 'rejected',
                rejectedBy: currentUser.email,
                rejectedAt: new Date().toISOString()
            })
            .then(() => {
                loadReservations();
            })
            .catch(error => {
                alert('Erro ao rejeitar reserva: ' + error.message);
            });
        }

        // Carregar registros de manutenção
        function loadMaintenanceRecords() {
            const statusFilter = document.getElementById('maintenanceStatusFilter').value;
            const equipmentFilter = document.getElementById('maintenanceEquipmentFilter').value;
            
            database.ref('maintenance').once('value', snapshot => {
                const maintenanceRecords = snapshot.val() || {};
                const tableBody = document.getElementById('maintenanceTableBody');
                tableBody.innerHTML = '';
                
                Object.values(maintenanceRecords).forEach(record => {
                    // Aplicar filtros
                    if (statusFilter !== 'all' && record.status !== statusFilter) return;
                    if (equipmentFilter !== 'all' && record.equipmentId !== equipmentFilter) return;
                    
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${record.id || 'N/A'}</td>
                        <td>${record.equipmentType || 'N/A'}</td>
                        <td>${record.equipmentSerial || 'N/A'}</td>
                        <td>${record.problem || 'N/A'}</td>
                        <td>${formatDate(record.registrationDate) || 'N/A'}</td>
                        <td><span class="badge ${getMaintenanceStatusBadgeClass(record.status)}">${record.status || 'N/A'}</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="viewMaintenanceDetails('${record.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-success btn-sm" onclick="completeMaintenance('${record.id}')">
                                <i class="fas fa-check"></i>
                            </button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            });
        }

        // Abrir modal de nova manutenção
        function openNewMaintenanceModal() {
            document.getElementById('newMaintenanceModal').style.display = 'flex';
        }

        // Carregar detalhes do equipamento para manutenção
        function loadEquipmentDetails() {
            const equipmentSerial = document.getElementById('maintenanceEquipment').value;
            
            if (!equipmentSerial) {
                document.getElementById('maintenanceSerialNumber').value = '';
                return;
            }
            
            database.ref('equipments').orderByChild('serialNumber').equalTo(equipmentSerial).once('value', snapshot => {
                const equipments = snapshot.val();
                
                if (equipments) {
                    const equipment = Object.values(equipments)[0];
                    document.getElementById('maintenanceSerialNumber').value = equipment.serialNumber;
                }
            });
        }

        // Submeter nova manutenção
        function submitMaintenance() {
            const maintenanceData = {
                equipmentId: document.getElementById('maintenanceEquipment').value,
                equipmentSerial: document.getElementById('maintenanceSerialNumber').value,
                equipmentType: document.getElementById('maintenanceEquipment').options[document.getElementById('maintenanceEquipment').selectedIndex].text.split(' (')[0],
                problem: document.getElementById('maintenanceProblem').value,
                diagnosis: document.getElementById('maintenanceDiagnosis').value,
                status: document.getElementById('maintenanceStatus').value,
                technician: document.getElementById('maintenanceTechnician').value,
                cost: parseFloat(document.getElementById('maintenanceCost').value) || 0,
                expectedCompletion: document.getElementById('maintenanceExpectedDate').value,
                reportedBy: currentUser.email,
                registrationDate: new Date().toISOString()
            };
            
            // Validar campos obrigatórios
            if (!maintenanceData.equipmentId || !maintenanceData.problem || !maintenanceData.status) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            // Gerar ID único para a manutenção
            const maintenanceId = database.ref().child('maintenance').push().key;
            maintenanceData.id = maintenanceId;
            
            // Salvar no Firebase
            database.ref('maintenance/' + maintenanceId).set(maintenanceData)
                .then(() => {
                    // Atualizar status do equipamento se necessário
                    if (maintenanceData.status === 'in_progress' || maintenanceData.status === 'pending') {
                        updateEquipmentStatus(maintenanceData.equipmentId, 'Manutenção');
                    }
                    
                    alert('Manutenção registrada com sucesso!');
                    closeModal('newMaintenanceModal');
                    loadMaintenanceRecords();
                    updateDashboard();
                })
                .catch(error => {
                    alert('Erro ao registrar manutenção: ' + error.message);
                });
        }

        // Completar manutenção
        function completeMaintenance(maintenanceId) {
            database.ref('maintenance/' + maintenanceId).once('value', snapshot => {
                const maintenance = snapshot.val();
                
                if (maintenance) {
                    // Atualizar status da manutenção
                    database.ref('maintenance/' + maintenanceId).update({
                        status: 'completed',
                        completedAt: new Date().toISOString(),
                        completedBy: currentUser.email
                    })
                    .then(() => {
                        // Atualizar status do equipamento para "Disponível"
                        updateEquipmentStatus(maintenance.equipmentId, 'Disponível');
                        
                        loadMaintenanceRecords();
                        updateDashboard();
                    })
                    .catch(error => {
                        alert('Erro ao completar manutenção: ' + error.message);
                    });
                }
            });
        }

        // Atualizar status do equipamento
        function updateEquipmentStatus(equipmentId, newStatus) {
            database.ref('equipments/' + equipmentId).update({
                status: newStatus,
                lastUpdated: new Date().toISOString()
            })
            .then(() => {
                updateDashboard();
            })
            .catch(error => {
                console.error('Erro ao atualizar status do equipamento:', error);
            });
        }

        // Carregar atividades
        function loadActivities() {
            const typeFilter = document.getElementById('activityTypeFilter').value;
            const userFilter = document.getElementById('activityUserFilter').value.toLowerCase();
            const dateFilter = document.getElementById('activityDateFilter').value;
            
            database.ref('activities').orderByChild('timestamp').once('value', snapshot => {
                const activities = snapshot.val() || {};
                const activityList = document.getElementById('activityList');
                activityList.innerHTML = '';
                
                // Converter objeto em array e ordenar por timestamp (mais recente primeiro)
                const activitiesArray = Object.values(activities).reverse();
                
                activitiesArray.forEach(activity => {
                    // Aplicar filtros
                    if (typeFilter !== 'all' && activity.type !== typeFilter) return;
                    if (userFilter && !activity.user.toLowerCase().includes(userFilter)) return;
                    if (dateFilter && !activity.timestamp.startsWith(dateFilter)) return;
                    
                    const activityItem = document.createElement('div');
                    activityItem.className = 'history-item';
                    
                    activityItem.innerHTML = `
                        <div class="history-date">
                            ${formatDateTime(activity.timestamp)}
                            <span class="badge ${getActivityBadgeClass(activity.type)}">${activity.type}</span>
                        </div>
                        <div class="history-action">
                            <strong>${activity.user}</strong> ${activity.action}
                        </div>
                    `;
                    
                    activityList.appendChild(activityItem);
                });
            });
        }

        // Atualizar relatório
        function updateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('reportDateRange').value;
            
            // Mostrar/ocultar campos de data personalizada
            if (dateRange === 'custom') {
                document.getElementById('customDateRangeGroup').style.display = 'block';
                document.getElementById('customDateRangeGroupEnd').style.display = 'block';
            } else {
                document.getElementById('customDateRangeGroup').style.display = 'none';
                document.getElementById('customDateRangeGroupEnd').style.display = 'none';
            }
            
            // Atualizar relatório com base no tipo selecionado
            switch(reportType) {
                case 'equipmentStatus':
                    generateEquipmentStatusReport();
                    break;
                case 'reservationsByMonth':
                    generateReservationsByMonthReport();
                    break;
                case 'maintenanceHistory':
                    generateMaintenanceHistoryReport();
                    break;
                case 'equipmentByLocation':
                    generateEquipmentByLocationReport();
                    break;
            }
        }

        // Gerar relatório de status dos equipamentos
        function generateEquipmentStatusReport() {
            database.ref('equipments').once('value', snapshot => {
                const equipments = snapshot.val() || {};
                const equipmentTypes = {};
                const locations = {};
                
                // Processar dados
                Object.values(equipments).forEach(equipment => {
                    // Por tipo
                    if (!equipmentTypes[equipment.type]) {
                        equipmentTypes[equipment.type] = {
                            total: 0,
                            available: 0,
                            inUse: 0,
                            maintenance: 0,
                            damaged: 0
                        };
                    }
                    
                    equipmentTypes[equipment.type].total++;
                    
                    switch(equipment.status) {
                        case 'Disponível':
                            equipmentTypes[equipment.type].available++;
                            break;
                        case 'Em uso':
                            equipmentTypes[equipment.type].inUse++;
                            break;
                        case 'Manutenção':
                            equipmentTypes[equipment.type].maintenance++;
                            break;
                        case 'Danificado':
                            equipmentTypes[equipment.type].damaged++;
                            break;
                    }
                    
                    // Por localização
                    if (!locations[equipment.location]) {
                        locations[equipment.location] = {
                            total: 0,
                            available: 0,
                            inUse: 0,
                            maintenance: 0,
                            damaged: 0
                        };
                    }
                    
                    locations[equipment.location].total++;
                    
                    switch(equipment.status) {
                        case 'Disponível':
                            locations[equipment.location].available++;
                            break;
                        case 'Em uso':
                            locations[equipment.location].inUse++;
                            break;
                        case 'Manutenção':
                            locations[equipment.location].maintenance++;
                            break;
                        case 'Danificado':
                            locations[equipment.location].damaged++;
                            break;
                    }
                });
                
                // Atualizar tabela
                const tableHeader = document.getElementById('reportTableHeader');
                const tableBody = document.getElementById('reportTableBody');
                
                tableHeader.innerHTML = `
                    <th>Tipo/Local</th>
                    <th>Total</th>
                    <th>Disponíveis</th>
                    <th>Em Uso</th>
                    <th>Manutenção</th>
                    <th>Danificados</th>
                `;
                
                tableBody.innerHTML = '';
                
                // Adicionar por tipo
                Object.keys(equipmentTypes).forEach(type => {
                    const row = document.createElement('tr');
                    const data = equipmentTypes[type];
                    
                    row.innerHTML = `
                        <td><strong>${type}</strong></td>
                        <td>${data.total}</td>
                        <td>${data.available}</td>
                        <td>${data.inUse}</td>
                        <td>${data.maintenance}</td>
                        <td>${data.damaged}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Adicionar por localização
                Object.keys(locations).forEach(location => {
                    const row = document.createElement('tr');
                    const data = locations[location];
                    
                    row.innerHTML = `
                        <td><em>${location}</em></td>
                        <td>${data.total}</td>
                        <td>${data.available}</td>
                        <td>${data.inUse}</td>
                        <td>${data.maintenance}</td>
                        <td>${data.damaged}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Atualizar gráfico
                updateReportChart(equipmentTypes, 'Tipo de Equipamento', 'Status dos Equipamentos por Tipo');
            });
        }

        // Gerar relatório de reservas por mês
        function generateReservationsByMonthReport() {
            database.ref('reservations').once('value', snapshot => {
                const reservations = snapshot.val() || {};
                const months = {};
                const statusCounts = {
                    pending: 0,
                    approved: 0,
                    rejected: 0,
                    completed: 0,
                    canceled: 0
                };
                
                // Processar dados
                Object.values(reservations).forEach(reservation => {
                    const date = new Date(reservation.createdAt);
                    const monthYear = `${date.getMonth() + 1}/${date.getFullYear()}`;
                    
                    if (!months[monthYear]) {
                        months[monthYear] = {
                            total: 0,
                            pending: 0,
                            approved: 0,
                            rejected: 0,
                            completed: 0,
                            canceled: 0
                        };
                    }
                    
                    months[monthYear].total++;
                    months[monthYear][reservation.status]++;
                    statusCounts[reservation.status]++;
                });
                
                // Atualizar tabela
                const tableHeader = document.getElementById('reportTableHeader');
                const tableBody = document.getElementById('reportTableBody');
                
                tableHeader.innerHTML = `
                    <th>Mês/Ano</th>
                    <th>Total</th>
                    <th>Pendentes</th>
                    <th>Aprovadas</th>
                    <th>Rejeitadas</th>
                    <th>Concluídas</th>
                    <th>Canceladas</th>
                `;
                
                tableBody.innerHTML = '';
                
                // Adicionar por mês
                Object.keys(months).sort().forEach(monthYear => {
                    const row = document.createElement('tr');
                    const data = months[monthYear];
                    
                    row.innerHTML = `
                        <td>${monthYear}</td>
                        <td>${data.total}</td>
                        <td>${data.pending}</td>
                        <td>${data.approved}</td>
                        <td>${data.rejected}</td>
                        <td>${data.completed}</td>
                        <td>${data.canceled}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Adicionar totais
                const totalRow = document.createElement('tr');
                totalRow.innerHTML = `
                    <td><strong>Total Geral</strong></td>
                    <td><strong>${Object.values(months).reduce((sum, m) => sum + m.total, 0)}</strong></td>
                    <td><strong>${statusCounts.pending}</strong></td>
                    <td><strong>${statusCounts.approved}</strong></td>
                    <td><strong>${statusCounts.rejected}</strong></td>
                    <td><strong>${statusCounts.completed}</strong></td>
                    <td><strong>${statusCounts.canceled}</strong></td>
                `;
                tableBody.appendChild(totalRow);
                
                // Atualizar gráfico
                updateReportChart(months, 'Mês/Ano', 'Reservas por Mês');
            });
        }

        // Gerar relatório de histórico de manutenções
        function generateMaintenanceHistoryReport() {
            database.ref('maintenance').once('value', snapshot => {
                const maintenanceRecords = snapshot.val() || {};
                const equipmentTypes = {};
                const statusCounts = {
                    pending: 0,
                    in_progress: 0,
                    completed: 0,
                    canceled: 0
                };
                
                // Processar dados
                Object.values(maintenanceRecords).forEach(record => {
                    if (!equipmentTypes[record.equipmentType]) {
                        equipmentTypes[record.equipmentType] = {
                            total: 0,
                            pending: 0,
                            in_progress: 0,
                            completed: 0,
                            canceled: 0
                        };
                    }
                    
                    equipmentTypes[record.equipmentType].total++;
                    equipmentTypes[record.equipmentType][record.status]++;
                    statusCounts[record.status]++;
                });
                
                // Atualizar tabela
                const tableHeader = document.getElementById('reportTableHeader');
                const tableBody = document.getElementById('reportTableBody');
                
                tableHeader.innerHTML = `
                    <th>Tipo de Equipamento</th>
                    <th>Total</th>
                    <th>Pendentes</th>
                    <th>Em Andamento</th>
                    <th>Concluídas</th>
                    <th>Canceladas</th>
                `;
                
                tableBody.innerHTML = '';
                
                // Adicionar por tipo de equipamento
                Object.keys(equipmentTypes).forEach(type => {
                    const row = document.createElement('tr');
                    const data = equipmentTypes[type];
                    
                    row.innerHTML = `
                        <td>${type}</td>
                        <td>${data.total}</td>
                        <td>${data.pending}</td>
                        <td>${data.in_progress}</td>
                        <td>${data.completed}</td>
                        <td>${data.canceled}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Adicionar totais
                const totalRow = document.createElement('tr');
                totalRow.innerHTML = `
                    <td><strong>Total Geral</strong></td>
                    <td><strong>${Object.values(equipmentTypes).reduce((sum, e) => sum + e.total, 0)}</strong></td>
                    <td><strong>${statusCounts.pending}</strong></td>
                    <td><strong>${statusCounts.in_progress}</strong></td>
                    <td><strong>${statusCounts.completed}</strong></td>
                    <td><strong>${statusCounts.canceled}</strong></td>
                `;
                tableBody.appendChild(totalRow);
                
                // Atualizar gráfico
                updateReportChart(equipmentTypes, 'Tipo de Equipamento', 'Manutenções por Tipo de Equipamento');
            });
        }

        // Gerar relatório de equipamentos por localização
        function generateEquipmentByLocationReport() {
            database.ref('equipments').once('value', snapshot => {
                const equipments = snapshot.val() || {};
                const locations = {};
                
                // Processar dados
                Object.values(equipments).forEach(equipment => {
                    if (!locations[equipment.location]) {
                        locations[equipment.location] = {};
                    }
                    
                    if (!locations[equipment.location][equipment.type]) {
                        locations[equipment.location][equipment.type] = 0;
                    }
                    
                    locations[equipment.location][equipment.type]++;
                });
                
                // Atualizar tabela
                const tableHeader = document.getElementById('reportTableHeader');
                const tableBody = document.getElementById('reportTableBody');
                
                // Obter todos os tipos de equipamento únicos
                const allTypes = new Set();
                Object.values(equipments).forEach(equipment => {
                    allTypes.add(equipment.type);
                });
                
                // Criar cabeçalho da tabela
                tableHeader.innerHTML = '<th>Localização</th>';
                allTypes.forEach(type => {
                    tableHeader.innerHTML += `<th>${type}</th>`;
                });
                tableHeader.innerHTML += '<th>Total</th>';
                
                // Criar corpo da tabela
                tableBody.innerHTML = '';
                
                Object.keys(locations).forEach(location => {
                    const row = document.createElement('tr');
                    let rowHtml = `<td>${location}</td>`;
                    let total = 0;
                    
                    allTypes.forEach(type => {
                        const count = locations[location][type] || 0;
                        rowHtml += `<td>${count}</td>`;
                        total += count;
                    });
                    
                    rowHtml += `<td><strong>${total}</strong></td>`;
                    row.innerHTML = rowHtml;
                    tableBody.appendChild(row);
                });
                
                // Adicionar totais
                const totalRow = document.createElement('tr');
                let totalRowHtml = '<td><strong>Total</strong></td>';
                let grandTotal = 0;
                
                allTypes.forEach(type => {
                    let typeTotal = 0;
                    Object.values(locations).forEach(locationData => {
                        typeTotal += locationData[type] || 0;
                    });
                    totalRowHtml += `<td><strong>${typeTotal}</strong></td>`;
                    grandTotal += typeTotal;
                });
                
                totalRowHtml += `<td><strong>${grandTotal}</strong></td>`;
                totalRow.innerHTML = totalRowHtml;
                tableBody.appendChild(totalRow);
                
                // Atualizar gráfico
                updateReportChart(locations, 'Localização', 'Equipamentos por Localização');
            });
        }

        // Atualizar gráfico de relatório
        function updateReportChart(data, labelKey, title) {
            const ctx = document.getElementById('reportChart').getContext('2d');
            
            // Preparar dados para o gráfico
            const labels = Object.keys(data);
            const datasets = [];
            
            // Determinar o tipo de gráfico com base nos dados
            let chartType = 'bar';
            let datasetConfig = {};
            
            if (title.includes('por Tipo') || title.includes('por Localização')) {
                // Gráfico de barras agrupadas
                const allStatuses = new Set();
                
                Object.values(data).forEach(item => {
                    Object.keys(item).forEach(key => {
                        if (key !== 'total') allStatuses.add(key);
                    });
                });
                
                allStatuses.forEach(status => {
                    const statusData = labels.map(label => data[label][status] || 0);
                    const color = getStatusColor(status);
                    
                    datasets.push({
                        label: formatStatus(status),
                        data: statusData,
                        backgroundColor: color,
                        borderColor: color,
                        borderWidth: 1
                    });
                });
            } else {
                // Gráfico de linhas para tendências temporais
                chartType = 'line';
                const totals = labels.map(label => data[label].total);
                
                datasets.push({
                    label: 'Total',
                    data: totals,
                    backgroundColor: 'rgba(52, 152, 219, 0.2)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    borderWidth: 2,
                    fill: true
                });
            }
            
            // Criar ou atualizar gráfico
            if (reportChart) {
                reportChart.destroy();
            }
            
            reportChart = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantidade'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: labelKey
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: title,
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Gerar relatório PDF
        function generatePDFReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const reportTitle = document.getElementById('reportType').options[document.getElementById('reportType').selectedIndex].text;
            const dateRange = document.getElementById('reportDateRange').options[document.getElementById('reportDateRange').selectedIndex].text;
            
            // Adicionar cabeçalho
            doc.setFontSize(18);
            doc.text(`Relatório: ${reportTitle}`, 14, 20);
            doc.setFontSize(12);
            doc.text(`Período: ${dateRange}`, 14, 28);
            doc.text(`Gerado em: ${formatDate(new Date().toISOString())}`, 14, 36);
            doc.text(`Gerado por: ${currentUser.email}`, 14, 44);
            
            // Adicionar tabela
            const table = document.getElementById('reportTable');
            doc.autoTable({
                html: table,
                startY: 50,
                theme: 'grid',
                headStyles: {
                    fillColor: [44, 62, 80],
                    textColor: 255
                },
                alternateRowStyles: {
                    fillColor: [245, 247, 250]
                }
            });
            
            // Adicionar gráfico (como imagem)
            const chartCanvas = document.getElementById('reportChart');
            const chartImage = chartCanvas.toDataURL('image/png');
            doc.addImage(chartImage, 'PNG', 15, doc.autoTable.previous.finalY + 20, 180, 100);
            
            // Salvar PDF
            doc.save(`Relatorio_${reportTitle.replace(/ /g, '_')}_${formatDate(new Date().toISOString(), 'YYYY-MM-DD')}.pdf`);
        }

        // Exportar para Excel
        function exportToExcel() {
            // Implementação simplificada - na prática, você pode usar uma biblioteca como SheetJS
            alert('Exportar para Excel será implementado aqui. Por enquanto, use a exportação para PDF.');
        }

        // Imprimir reservas
        function printReservations() {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Relatório de Reservas</title>
                        <style>
                            body { font-family: Arial, sans-serif; }
                            h1 { color: #2c3e50; }
                            table { border-collapse: collapse; width: 100%; margin-top: 20px; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background-color: #34495e; color: white; }
                        </style>
                    </head>
                    <body>
                        <h1>Relatório de Reservas</h1>
                        <p>Gerado em: ${formatDate(new Date().toISOString())}</p>
                        ${document.getElementById('reservations').innerHTML}
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() { window.close(); }, 1000);
                            };
                        </script>
                    </body>
                </html>
            `);
            printWindow.document.close();
        }

        // Visualizar detalhes da reserva
        function viewReservationDetails(reservationId) {
            database.ref('reservations/' + reservationId).once('value', snapshot => {
                const reservation = snapshot.val();
                
                if (reservation) {
                    alert(`Detalhes da Reserva:\n\nID: ${reservation.id}\nEquipamento: ${reservation.equipment}\nUsuário: ${reservation.user}\nData: ${formatDate(reservation.date)}\nHorário: ${reservation.startTime} - ${reservation.endTime}\nStatus: ${reservation.status}\nFinalidade: ${reservation.purpose || 'N/A'}`);
                }
            });
        }

        // Visualizar detalhes da manutenção
        function viewMaintenanceDetails(maintenanceId) {
            database.ref('maintenance/' + maintenanceId).once('value', snapshot => {
                const maintenance = snapshot.val();
                
                if (maintenance) {
                    alert(`Detalhes da Manutenção:\n\nID: ${maintenance.id}\nEquipamento: ${maintenance.equipmentType} (${maintenance.equipmentSerial})\nProblema: ${maintenance.problem}\nDiagnóstico: ${maintenance.diagnosis || 'N/A'}\nStatus: ${formatStatus(maintenance.status)}\nTécnico: ${maintenance.technician || 'N/A'}\nCusto: R$ ${maintenance.cost.toFixed(2) || '0.00'}\nRegistrado por: ${maintenance.reportedBy}\nData: ${formatDate(maintenance.registrationDate)}`);
                }
            });
        }

        // Abrir termo de responsabilidade
        function openResponsibilityTerm(equipmentId) {
            database.ref('equipments/' + equipmentId).once('value', snapshot => {
                const equipment = snapshot.val();
                
                if (equipment) {
                    // Preencher dados do termo
                    document.getElementById('termoUserName').textContent = currentUser.email.split('@')[0];
                    document.getElementById('termoDate').textContent = formatDate(new Date().toISOString());
                    
                    // Limpar tabela de equipamentos
                    const equipmentTable = document.getElementById('termoEquipmentTable');
                    equipmentTable.innerHTML = '';
                    
                    // Adicionar equipamento
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${equipment.type}</td>
                        <td>${equipment.serialNumber}</td>
                        <td>N/A</td>
                        <td>${equipment.status}</td>
                    `;
                    equipmentTable.appendChild(row);
                    
                    // Mostrar modal
                    document.getElementById('responsibilityTermModal').style.display = 'flex';
                }
            });
        }

        // Imprimir termo de responsabilidade
        function printTermo() {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Termo de Responsabilidade</title>
                        <style>
                            body { font-family: Arial, sans-serif; line-height: 1.6; }
                            .termo-title { text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 20px; color: #2c3e50; }
                            .termo-content { line-height: 1.8; }
                            .termo-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            .termo-table th, .termo-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            .termo-table th { background-color: #f2f2f2; }
                            .termo-signature { margin-top: 40px; text-align: center; }
                            .termo-info { display: flex; justify-content: space-between; margin-top: 20px; }
                        </style>
                    </head>
                    <body>
                        ${document.getElementById('termoContent').innerHTML}
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() { window.close(); }, 1000);
                            };
                        </script>
                    </body>
                </html>
            `);
            printWindow.document.close();
        }

        // Funções auxiliares
        function formatDate(dateString, format = 'DD/MM/YYYY') {
            if (!dateString) return 'N/A';
            
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'N/A';
            
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            
            if (format === 'YYYY-MM-DD') {
                return `${year}-${month}-${day}`;
            }
            
            return `${day}/${month}/${year}`;
        }

        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return 'N/A';
            
            const date = new Date(dateTimeString);
            if (isNaN(date.getTime())) return 'N/A';
            
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }

        function getStatusClass(status) {
            switch(status) {
                case 'Disponível':
                    return 'status-available';
                case 'Em uso':
                    return 'status-inuse';
                case 'Manutenção':
                    return 'status-maintenance';
                case 'Danificado':
                    return 'status-damaged';
                default:
                    return 'status-unused';
            }
        }

        function getStatusBadgeClass(status) {
            switch(status) {
                case 'pending':
                    return 'badge-warning';
                case 'approved':
                    return 'badge-success';
                case 'rejected':
                    return 'badge-danger';
                case 'completed':
                    return 'badge-primary';
                case 'canceled':
                    return 'badge-secondary';
                default:
                    return 'badge-info';
            }
        }

        function getMaintenanceStatusBadgeClass(status) {
            switch(status) {
                case 'pending':
                    return 'badge-warning';
                case 'in_progress':
                    return 'badge-primary';
                case 'completed':
                    return 'badge-success';
                case 'canceled':
                    return 'badge-danger';
                default:
                    return 'badge-info';
            }
        }

        function getActivityBadgeClass(type) {
            switch(type) {
                case 'equipment':
                    return 'badge-primary';
                case 'reservation':
                    return 'badge-success';
                case 'maintenance':
                    return 'badge-warning';
                case 'user':
                    return 'badge-info';
                default:
                    return 'badge-secondary';
            }
        }

        function getStatusColor(status) {
            switch(status) {
                case 'available':
                case 'Disponível':
                case 'completed':
                case 'approved':
                    return 'rgba(39, 174, 96, 0.7)';
                case 'inUse':
                case 'Em uso':
                case 'in_progress':
                    return 'rgba(52, 152, 219, 0.7)';
                case 'maintenance':
                case 'Manutenção':
                case 'pending':
                    return 'rgba(243, 156, 18, 0.7)';
                case 'damaged':
                case 'Danificado':
                case 'rejected':
                case 'canceled':
                    return 'rgba(231, 76, 60, 0.7)';
                default:
                    return 'rgba(149, 165, 166, 0.7)';
            }
        }

        function formatStatus(status) {
            const statusMap = {
                'pending': 'Pendente',
                'approved': 'Aprovado',
                'rejected': 'Rejeitado',
                'completed': 'Concluído',
                'canceled': 'Cancelado',
                'in_progress': 'Em Andamento',
                'available': 'Disponível',
                'inUse': 'Em Uso',
                'maintenance': 'Manutenção',
                'damaged': 'Danificado'
            };
            
            return statusMap[status] || status;
        }
    </script>
</body>
</html>
